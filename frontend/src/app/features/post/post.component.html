<section
  class="max-w-4xl mx-auto mt-8 p-6 bg-white dark:bg-gray-800 rounded shadow"
>
  <!-- Loading / No post -->
  <div *ngIf="!post" class="text-center mt-10 text-gray-500 dark:text-gray-300">
    Loading post...
  </div>

  <ng-container *ngIf="post">
    <!-- Post Image -->
    <img
      [src]="post.imageUrl ? post.imageUrl : 'assets/default-image.png'"
      class="w-full h-96 object-cover rounded mb-4"
      alt="Post image"
    />

    <!-- Title + Like button -->
    <div
      class="flex flex-col sm:flex-row items-center justify-between mb-4 w-full"
    >
      <h1
        class="text-3xl font-bold text-gray-900 dark:text-gray-100 break-words break-all leading-snug"
      >
        {{ post.title }}
      </h1>

      <div class="relative">
        <button
          (click)="toggleLike()"
          class="flex items-center space-x-2 px-3 py-2 rounded-full transition focus:outline-none cursor-pointer relative overflow-hidden text-lg"
          [ngClass]="
            liked
              ? 'bg-red-100 text-red-600 dark:bg-red-600 dark:text-red-100'
              : 'bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300'
          "
        >
          <span [class.animate-ping]="animating">❤️</span>
          <span class="ml-1 text-md font-medium">{{ likesCount }}</span>
        </button>

        <!-- Floating Hearts -->
        <ng-container *ngFor="let h of floatingHearts">
          <div
            class="w-5 h-5 floating-heart absolute"
            [style.left.px]="h.offset"
            [style.animationDelay.ms]="h.delay"
            style="top: -28px"
          >
            ❤️
          </div>
        </ng-container>
      </div>
    </div>

    <!-- Author row with hover and delete button -->
    <div class="flex items-center justify-between mb-4 w-full relative">
      <!-- Left side: avatar + name + date -->
      <div class="flex items-center space-x-3">
        <a
          [routerLink]="['/profile', post.authorId]"
          class="flex items-center space-x-2 hover:underline relative"
          (mouseenter)="onAuthorHover()"
          (mouseleave)="onAuthorLeave()"
        >
          <img
            [src]="getAvatar(post.author || author)"
            alt="Author Avatar"
            class="w-10 h-10 rounded-full border-2 border-teal-500 shadow-sm object-cover"
          />
          <span
            class="font-semibold text-gray-900 dark:text-gray-100 break-words"
          >
            {{ post.author?.firstName || author?.firstName || "Unknown" }}
            <span *ngIf="post.author?.middleName || author?.middleName">
              {{ post.author?.middleName || author?.middleName }}
            </span>
            <span *ngIf="post.author?.lastName || author?.lastName">
              {{ post.author?.lastName || author?.lastName }}
            </span>
          </span>
        </a>

        <!-- Post Date -->
        <span class="text-gray-500 dark:text-gray-400 text-sm">
          {{ post.createdAt | date : "MMMM d, y" }}
        </span>
      </div>

      <!-- Hover Card -->
      <div
        *ngIf="showUserCard && hoveredUser"
        class="absolute top-full left-0 mt-2 z-50 w-64 bg-white dark:bg-gray-700 shadow-lg rounded-xl p-4 border border-gray-200 dark:border-gray-600 transition transform scale-100 hover:scale-[1.02]"
        (mouseenter)="clearHideTimeout()"
        (mouseleave)="onAuthorLeave()"
      >
        <div class="flex items-center space-x-3 mb-3">
          <img
            [src]="getAvatar(hoveredUser)"
            alt="Avatar"
            class="w-12 h-12 rounded-full border-2 border-teal-500 object-cover"
          />
          <div>
            <h3 class="font-semibold text-gray-900 dark:text-gray-100">
              {{ hoveredUser.firstName }}
              <span *ngIf="hoveredUser.middleName">
                {{ hoveredUser.middleName }}</span
              >
              <span *ngIf="hoveredUser.lastName">
                {{ hoveredUser.lastName }}</span
              >
            </h3>
            <p class="text-sm text-gray-500 dark:text-gray-300">
              {{ hoveredUser.email }}
            </p>
          </div>
        </div>

        <p class="text-sm text-gray-600 dark:text-gray-300 line-clamp-3">
          {{ hoveredUser.bio || "No bio available." }}
        </p>

        <div
          class="mt-3 flex justify-between text-sm text-gray-500 dark:text-gray-300"
        >
          <span>Followers: {{ hoveredUser.followerIds?.length || 0 }}</span>
          <span>Following: {{ hoveredUser.followingIds?.length || 0 }}</span>
        </div>
      </div>
      <button
        *ngIf="userId === post.authorId"
        (click)="deletePost()"
        class="px-3 py-2 text-sm text-white bg-red-600 hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600 rounded shadow transition cursor-pointer"
        title="Delete this post"
      >
        Delete
      </button>
    </div>

    <!-- Post Content -->
    <p
      class="text-lg text-gray-800 dark:text-gray-200 leading-relaxed whitespace-pre-wrap break-words"
    >
      {{ post.content }}
    </p>

    <!-- Comments -->
    <app-comments *ngIf="post" [postId]="post.id"></app-comments>
  </ng-container>
</section>
