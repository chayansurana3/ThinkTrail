<section
  class="max-w-3xl mx-auto mt-12 p-8 bg-white dark:bg-gray-800 shadow-xl dark:shadow-gray-800 rounded-2xl space-y-8 transition-all duration-300 hover:shadow-2xl"
>
  <!-- Profile Header -->
  <div class="flex flex-col items-center space-y-4">
    <!-- Avatar -->
    <div class="relative">
      <img
        [src]="profileImage"
        alt="Profile Picture"
        class="w-28 h-28 rounded-full border-4 border-teal-500 dark:border-teal-400 shadow-lg object-cover text-center"
      />
<label
  *ngIf="isOwnProfile && isEditMode"
  (click)="openAvatarModal()"
  class="absolute bottom-0 right-0 bg-teal-600 dark:bg-teal-500 text-white p-2 rounded-full cursor-pointer hover:bg-teal-700 dark:hover:bg-teal-400"
>
  <i class="fas fa-camera"></i>
</label>

    </div>
    <!-- Name + Bio -->
    <div class="text-center">
      <h2 class="text-3xl font-extrabold text-gray-800 dark:text-gray-100">
        {{ user.firstName }} {{ user.middleName ? user.middleName : " " }}
        {{ user.lastName ? user.lastName : " " }}
      </h2>
      <p class="text-gray-500 dark:text-gray-300 italic mt-2">
        {{ user.bio || "No bio added yet." }}
      </p>
    </div>
    <!-- Action Buttons -->
    <div *ngIf="isOwnProfile; else otherProfile" class="flex space-x-3">
      <button
        (click)="toggleEdit()"
        class="px-6 py-2 rounded-lg bg-teal-600 dark:bg-teal-500 text-white hover:bg-teal-700 dark:hover:bg-teal-400 transition-all shadow cursor-pointer text-center"
      >
        <i class="fas fa-user-edit mr-2"></i
        >{{ isEditMode ? "Cancel" : "Edit Profile" }}
      </button>
    </div>
    <ng-template #otherProfile>
      <div class="flex space-x-3">
        <button
          (click)="toggleFollow()"
          class="px-6 py-2 rounded-lg transition-all shadow cursor-pointer text-center"
          [ngClass]="
            isFollowing
              ? 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600'
              : 'bg-teal-600 dark:bg-teal-500 text-white hover:bg-teal-700 dark:hover:bg-teal-400'
          "
        >
          <i
            class="fas"
            [ngClass]="isFollowing ? 'fa-user-check' : 'fa-user-plus'"
          ></i>
          {{ isFollowing ? "Following ✅" : "Follow" }}
        </button>
      </div>
    </ng-template>
  </div>
  <!-- PROFILE INFO -->
  <div
    *ngIf="!isEditMode"
    class="grid grid-cols-2 gap-6 text-gray-700 dark:text-gray-300 text-lg"
  >
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>Gender:</strong> {{ user.gender || "—" }}</p>
    <p><strong>Age:</strong> {{ user.age || "—" }}</p>
    <p>
      <strong>Followers: </strong
      >{{ user.followerIds?.length ? user.followerIds?.length : 0 }}
    </p>
  </div>
  <!-- EDIT FORM -->
  <form
    *ngIf="isEditMode"
    [formGroup]="form"
    (ngSubmit)="save()"
    class="space-y-6"
  >
    <div class="grid grid-cols-3 gap-4">
      <input
        type="text"
        formControlName="firstName"
        placeholder="First Name"
        class="p-3 border rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100"
      />
      <input
        type="text"
        formControlName="middleName"
        placeholder="Middle Name"
        class="p-3 border rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100"
      />
      <input
        type="text"
        formControlName="lastName"
        placeholder="Last Name"
        class="p-3 border rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100"
      />
    </div>
    <input
      type="text"
      formControlName="email"
      placeholder="Email"
      class="w-full p-3 border rounded-lg bg-gray-100 dark:bg-gray-700 dark:text-gray-200"
      isDisabled
    />
    <textarea
      formControlName="bio"
      placeholder="Bio"
      rows="3"
      class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100"
    ></textarea>
    <div class="grid grid-cols-2 gap-4">
      <select
        formControlName="gender"
        class="p-3 border rounded-lg cursor-pointer focus:ring-2 focus:ring-teal-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100"
      >
        <option value="" disabled>Gender</option>
        <option>Male</option>
        <option>Female</option>
        <option>Others</option>
      </select>
      <input
        type="number"
        formControlName="age"
        placeholder="Age"
        class="p-3 border rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100"
        min="1"
        max="150"
      />
    </div>
    <div class="flex space-x-3">
      <button
        type="submit"
        class="flex-1 py-3 bg-teal-600 dark:bg-teal-500 text-white hover:bg-teal-700 dark:hover:bg-teal-400 transition-all shadow cursor-pointer text-center"
      >
        <i class="fas fa-save mr-2"></i>Save Changes
      </button>
      <button
        type="button"
        (click)="toggleEdit()"
        class="flex-1 py-3 bg-gray-500 dark:bg-gray-700 text-white hover:bg-gray-600 dark:hover:bg-gray-600 transition-all shadow cursor-pointer text-center"
      >
        Cancel
      </button>
    </div>
  </form>
  <!-- AVATAR SELECTION MODAL -->
  <div
    *ngIf="showAvatarModal"
    class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
  >
    <div
      class="bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-2xl max-w-lg w-full space-y-4"
    >
      <h3
        class="text-2xl font-bold text-center text-gray-800 dark:text-gray-100"
      >
        Choose Your Avatar
      </h3>
      <div class="grid grid-cols-4 gap-4 mt-4">
        <div
          *ngFor="let avatar of avatars; let i = index"
          class="relative cursor-pointer group"
          (click)="selectAvatar(i)"
        >
          <img
            [src]="avatar"
            alt="Avatar"
            class="w-20 h-20 rounded-full border-4 transition-all duration-200 object-cover"
            [ngClass]="
              selectedAvatarIndex === i
                ? 'border-teal-600 dark:border-teal-400 scale-110'
                : 'border-transparent group-hover:scale-105'
            "
          />
        </div>
      </div>
      <div class="flex justify-end mt-6 space-x-3">
        <button
          class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition"
          (click)="closeAvatarModal()"
        >
          Cancel
        </button>
        <button
          class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition"
          (click)="saveSelectedAvatar()"
        >
          Save
        </button>
      </div>
    </div>
  </div>
</section>
